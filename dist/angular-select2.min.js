angular.module("rt.select2",[]).value("select2Config",{}).factory("select2Stack",function(){var a=[];return{$register:function(b){a.push(b)},$unregister:function(b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)},closeAll:function(){a.forEach(function(a){a.close()})}}}).directive("select2",["$rootScope","$timeout","$parse","$filter","select2Config","select2Stack",function(a,b,c,d,e,f){"use strict";var g=d("filter"),h={},i=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(h,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(a,d,e,j){function k(b){if(p){var c=p(a);if(c)return g(b,c)}return b}function l(a){m(o?function(b){var c=[];b=b.concat(y||[]);for(var d=0;d<b.length;d++){var e=b[d],f=j.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}y=angular.copy(c),a(c)}:function(){a(q[j.$viewValue]||{obj:{}})})}var m,n=angular.extend({},h,a.$eval(e.options)),o=angular.isDefined(e.multiple)||n.multiple;n.multiple=o,o&&(j.$isEmpty=function(a){return!a||0===a.length}),n.placeholder=e.placeholder||" ";var p=c(e.optionsFilter),q={};if(e.s2Options){var r;if(!(r=e.s2Options.match(i)))throw new Error("Invalid s2Options encountered!");var s=c(r[2]||r[1]),t=c(r[7]),u=r[4]||r[6],v=c(r[2]?r[1]:u),w=r[5];m=function(b){q={};for(var c=k(t(a)),d=c||[],e=[],f=0;f<d.length;f++){var g={},h=f;w&&(h=d[f],g[w]=h),g[u]=c[h];var i=v(a,g),j=s(a,g)||"";q[i]={id:i,text:j,obj:c[h]},e.push(q[i])}b(e)},n.query=function(b){for(var c=k(t(a)),d=c||[],e=[],f=0;f<d.length;f++){var g={},h=f;w&&(h=d[f],g[w]=h),g[u]=c[h];var i=v(a,g),j=s(a,g)||"";j.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:i,text:j,obj:c[h]})}b.callback({results:e})},a.$watch(r[7],function(){j.$render()})}else{if(!n.query)throw new Error("You need to supply a query function!");var x=n.query;n.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];q[d.id]=d}b(a)},x(a)},m=function(a){n.query({term:"",selected:j.$viewValue,callback:function(b){a(b.results)}})}}var y=[];if(j.$render=function(){l(function(a){o?d.select2("data",a):d.select2("val",a.id)})},n.initSelection){var z=n.initSelection;n.initSelection=function(a,b){z(a,function(a){q[a.id]=a,b(a)})}}else n.initSelection=function(a,b){l(b)};var A={close:function(){d.select2("close")}};f.$register(A),a.$on("destroy",function(){f.$unregister(A)}),b(function(){d.select2(n),d.select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){d.select2("onSortStart")},update:function(){d.select2("onSortEnd")}}),d.on("change",function(b){a.$evalAsync(function(){var a;if(o){for(var c=[],d=0;d<b.val.length;d++)a=q[b.val[d]],a&&c.push(a.id);j.$setViewValue(c)}else a=q[b.val],j.$setViewValue(a?a.id:null)})}),d.on("select2-blur",function(){j.$touched||a.$evalAsync(j.$setTouched)}),j.$render()})}}}]);